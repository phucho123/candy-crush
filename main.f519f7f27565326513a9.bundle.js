(()=>{"use strict";var e,t={5:(e,t,i)=>{i(260);class s extends Phaser.Scene{constructor(){super({key:"BootScene"})}preload(){this.cameras.main.setBackgroundColor(10016391),this.createLoadingbar(),this.load.on("progress",(e=>{this.progressBar.clear(),this.progressBar.fillStyle(16774867,1),this.progressBar.fillRect(this.cameras.main.width/4,this.cameras.main.height/2-16,this.cameras.main.width/2*e,16)}),this),this.load.on("complete",(()=>{this.progressBar.destroy(),this.loadingBar.destroy()}),this),this.load.pack("preload","./assets/pack.json","preload")}update(){this.scene.start("GameScene")}createLoadingbar(){this.loadingBar=this.add.graphics(),this.loadingBar.fillStyle(6139463,1),this.loadingBar.fillRect(this.cameras.main.width/4-2,this.cameras.main.height/2-18,this.cameras.main.width/2+4,20),this.progressBar=this.add.graphics()}}const h={score:0,highscore:0,gridWidth:8,gridHeight:8,tileWidth:64,tileHeight:72,candyTypes:["cookie1","cookie2","croissant","cupcake","donut","eclair","macaroon","pie","poptart1","poptart2","starcookie1","starcookie2"],alignY:144,delta:7};class l extends Phaser.GameObjects.Image{constructor(e){super(e.scene,e.x,e.y,e.texture,e.frame),this.overlap=0,this.setDepth(-1),this.setInteractive(),this.setColor(),this.matches5EffectImage=this.scene.add.image(this.x,this.y,"shockWave").setVisible(!1).setDepth(-.5),this.scene.add.existing(this),this.setScale(.9)}setOverlap(e){this.overlap=e,this.overlap>=4&&(this.matches4Tween&&!this.matches4Tween.isDestroyed()||(this.matches4Tween=this.scene.add.tween({targets:this,duration:500,yoyo:!0,scale:.7,repeat:-1,ease:"sine.inout"})),this.matches5Tween&&!this.matches5Tween.isDestroyed()||(this.matches5EffectImage.setVisible(!0),this.matches5EffectImage.setAlpha(1).setScale(0),this.matches5Tween=this.scene.add.tween({targets:this.matches5EffectImage,scale:2.5,alpha:.2,yoyo:!1,duration:1e3,repeat:-1,onUpdate:()=>{this.matches5EffectImage.setPosition(this.x,this.y)}}))),this.overlap>=5&&(this.setTexture("bomb"),this.matches5Tween&&!this.matches5Tween.isDestroyed()||(this.matches5EffectImage.setVisible(!0),this.matches5EffectImage.setAlpha(1).setScale(0),this.matches5Tween=this.scene.add.tween({targets:this.matches5EffectImage,scale:2.5,alpha:.2,yoyo:!1,duration:1e3,repeat:-1,onUpdate:()=>{this.matches5EffectImage.setPosition(this.x,this.y)}})))}getOverlap(){return this.overlap}destroy(){this.setActive(!1),this.setVisible(!1),this.overlap=0,this.matches4Tween&&this.matches4Tween.destroy(),this.matches5Tween&&(this.matches5EffectImage.setVisible(!1),this.matches5Tween.destroy())}isDestroyed(){return!this.active}getColor(){return this.color}setColor(){switch(this.color="white",this.texture.key){case"cookie1":case"cookie2":case"croissant":case"pie":case"starcookie1":this.color="yellow";break;case"cupcake":case"donut":this.color="red";break;case"eclair":case"poptart2":case"startcookie2":this.color="white";break;case"macaroon":this.color="green";break;case"poptart1":this.color="blue"}}}class r{constructor(e){this.scene=e,this.pool=[]}static getInstance(e){return r.instance||(console.log("Create new Object Pool"),r.instance=new r(e)),r.instance}addTile(e,t){const i=h.candyTypes[Phaser.Math.RND.between(8,h.candyTypes.length-1)],s=this.pool.filter((e=>!e.active));if(this.pool.length<h.gridWidth*h.gridHeight||s.length<=0){console.log("Create new Tile");const s=new l({scene:this.scene,x:e*h.tileWidth+h.tileWidth/2,y:t*h.tileHeight+h.tileHeight/2+h.alignY,texture:i});return this.pool.push(s),s}return s.length&&(s[0].setTexture(i),s[0].setActive(!0),s[0].setVisible(!0),s[0].setAlpha(1),s[0].setScale(.9),s[0].setDepth(-1),s[0].setPosition(e*h.tileWidth+h.tileWidth/2,t*h.tileHeight+h.tileHeight/2+h.alignY),s[0].setColor()),s[0]}}r.instance=null;class a extends Phaser.GameObjects.Image{constructor(e){super(e,0,0,""),this.sizeX=1,this.scaleDir=-1,this.dir=-1,this.colors=["red","green","yellow","blue"],console.log("Create new confitti"),this.delta=1,this.setTexture(this.colors[Phaser.Math.Between(0,3)]),this.scene.physics.world.enable(this),this.body.setAllowGravity(!0);const t=.1*Phaser.Math.Between(1,5);this.setScale(t).setDepth(1),this.body.setMass(1)}fire(e){this.setAlpha(1),this.dir=e,1==this.dir?this.setPosition(Phaser.Math.Between(-300,0),Phaser.Math.Between(this.scene.sys.canvas.height/2-100,this.scene.sys.canvas.height/2+100)):this.setPosition(Phaser.Math.Between(this.scene.sys.canvas.width,this.scene.sys.canvas.width+300),Phaser.Math.Between(this.scene.sys.canvas.height/2-100,this.scene.sys.canvas.height/2+100)),this.body.setAcceleration(200*this.dir,-200),this.body.setVelocity(this.dir*Phaser.Math.Between(500,600),-Phaser.Math.Between(500,600)),this.setActive(!0),this.setVisible(!0),this.rotation=Phaser.Math.Between(1,20)*Math.PI/10,this.sizeX=Phaser.Math.Between(1,9)/10}update(e,t){this.delta=t/h.delta,this.sizeX+=.03*this.scaleDir*this.delta,this.sizeX<=0&&this.scaleDir<0?(this.sizeX=0,this.scaleDir=1):this.sizeX>=1&&this.scaleDir>0&&(this.sizeX=1,this.scaleDir=-1),this.setRotation(.007*this.delta+this.rotation),this.scaleX=this.sizeX*this.scale;const i=.0035*-this.dir,s=.5*i*Math.pow(this.body.velocity.x,2)/this.body.mass,l=-.5*Math.abs(i)*Math.pow(this.body.velocity.y,2)/this.body.mass;this.body.acceleration.x*this.dir<0&&(this.body.velocity.x+this.body.acceleration.x)*this.dir<=0?(this.body.setAccelerationX(0),this.body.setVelocityX(50*this.dir)):this.body.acceleration.x*this.dir>0?this.body.setAccelerationX(this.body.acceleration.x+s):0==this.body.acceleration.x&&(this.alpha=Math.max(this.alpha-.005,0)),this.body.setAccelerationY(Math.max(0,this.body.acceleration.y+l*this.delta)),(this.y>this.scene.sys.canvas.height||this.alpha<=0)&&this.setActive(!1)}}class n{constructor(e){this.scene=e,this.init()}static getInstance(e){return n.instance||(n.instance=new n(e)),n.instance}init(){this.pool=this.scene.add.group({classType:a,maxSize:200,runChildUpdate:!0})}playConfettiEffect(){let e=this.pool.get(),t=0;for(;e;)t%2==0?e.fire(1):e.fire(-1),t++,e=this.pool.get()}}n.instance=null;class o{constructor(e){this.scene=e,this.gameScene=p.getIntance(),this.createBoardEmitter(),this.customEmitter=n.getInstance(this.scene)}static getInstance(e){return o.instance||(o.instance=new o(e)),o.instance}update(){}createBoardEmitter(){this.boardEmitter=[];for(let e=0;e<h.gridHeight;e++){this.boardEmitter[e]=[];for(let t=0;t<h.gridWidth;t++){const i=this.scene.add.particles(t*h.tileWidth+h.tileWidth/2,e*h.tileHeight+h.tileHeight/2+h.alignY,"flares",{frame:["white"],lifespan:300,speed:{min:100,max:150},scale:{start:.8,end:0},gravityY:0,blendMode:"ADD",emitting:!1}).setDepth(-2);this.boardEmitter[e].push(i)}}}explodeBoardEmitter(e,t){this.boardEmitter[t][e].explode(10)}setColorEmitter(e,t,i){this.boardEmitter[t][e].setConfig({frame:[i],lifespan:300,speed:{min:100,max:150},scale:{start:.8,end:0},gravityY:0,blendMode:"ADD",emitting:!1})}playConfettiEffect(){this.customEmitter.playConfettiEffect()}}o.instance=null;class d extends Phaser.GameObjects.Container{constructor(e){super(e),this.levelupImage=this.scene.add.image(0,0,"levelup"),this.levelupImage.setScale(.8*this.scene.sys.canvas.width/this.levelupImage.displayWidth),this.add(this.levelupImage),this.setSize(this.levelupImage.displayWidth,this.levelupImage.displayHeight),this.levelDisplay=this.scene.add.bitmapText(0,0,"font","0",64).setOrigin(.5).setDepth(2).setTint(5390863),this.add(this.levelupImage),this.add(this.levelDisplay),this.setAlpha(0),this.setPosition(-100,this.scene.sys.canvas.height/2),this.scene.add.existing(this)}static getInstance(e){return d.instance||(d.instance=new d(e)),d.instance}setContent(e){this.levelDisplay.setText(`${e}`)}resetPosition(){this.setAlpha(1),this.setPosition(this.scene.sys.canvas.width/2,1e3)}}d.instance=null;class c{constructor(e){this.i=0,this.timeArround=5,this.scene=e,this.gameScene=p.getIntance(),this.gameObj=[],this.levelupPopup=d.getInstance(this.scene),this.rect=new Phaser.Geom.Rectangle(this.scene.sys.canvas.width/2-150,this.scene.sys.canvas.height/2+100-150,300,300),this.ellipse=new Phaser.Geom.Ellipse(this.scene.sys.canvas.width/2,this.scene.sys.canvas.height/2+100,400,400),this.grids=[];for(let e=0;e<h.gridHeight;e++){this.grids[e]=[];for(let t=0;t<h.gridWidth;t++)this.grids[e].push(this.scene.add.rectangle(t*h.tileWidth+h.tileWidth/2,e*h.tileHeight+h.tileHeight/2+h.alignY,h.tileWidth-5,h.tileHeight-5,16777215).setDepth(-10).setAlpha(0))}}static getInstance(e){return c.instance||(c.instance=new c(e)),c.instance}restartTweenPlay(e){const t=this.gameObj.length;for(let i=0;i<h.gridHeight;i++)for(let s=0;s<h.gridWidth;s++)t?this.gameObj[i*h.gridWidth+s]=e[i][s]:this.gameObj.push(e[i][s]);let i;const s=Phaser.Math.Between(0,1);0==s?(i=this.rect,Phaser.Actions.PlaceOnRectangle(this.gameObj,this.rect)):(i=this.ellipse,Phaser.Actions.PlaceOnEllipse(this.gameObj,this.ellipse),this.scene.tweens.add({targets:i,width:600,height:200,duration:1e3,ease:"Sine.easeInOut",repeat:1,yoyo:!0}),this.scene.tweens.add({targets:i,width:200,height:600,delay:1e3,duration:1e3,ease:"Sine.easeInOut",repeat:1,yoyo:!0})),this.restartTween&&this.restartTween.destroy(),this.restartTween=this.scene.tweens.add({targets:i,x:i.x,y:i.y,ease:"Quintic.easeInOut",duration:2e3,yoyo:!0,repeat:0,onUpdate:()=>{this.timeArround--,this.timeArround<=0&&(0==s?(Phaser.Actions.PlaceOnRectangle(this.gameObj,this.rect,this.i),this.timeArround=5):(Phaser.Actions.PlaceOnEllipse(this.gameObj,this.ellipse,this.i),this.timeArround=3),this.i++,this.i===this.gameObj.length&&(this.i=0))},onComplete:()=>{if(e)for(let t=0;t<h.gridHeight;t++)for(let i=0;i<h.gridWidth;i++)t==h.gridHeight-1&&i==h.gridWidth-1?this.scene.add.tween({targets:e[t][i],x:(i+.5)*h.tileWidth,y:(t+.5)*h.tileHeight+h.alignY,repeat:0,ease:"bounce.out",duration:1e3,onComplete:()=>{var e;null===(e=this.gameScene)||void 0===e||e.checkMatches()}}):this.scene.add.tween({targets:e[t][i],x:(i+.5)*h.tileWidth,y:(t+.5)*h.tileHeight+h.alignY,repeat:0,ease:"bounce.out",duration:1e3})}})}selectedTileTweenPlay(e,t){1==t?(this.selectedTileTweenDestroy(1),e.angle=-30,this.firstSelectedTileTween=this.scene.add.tween({targets:e,angle:30,yoyo:!0,duration:300,repeat:-1})):2==t&&(this.selectedTileTweenDestroy(2),e.angle=-30,this.secondSelectedTileTween=this.scene.add.tween({targets:e,angle:30,yoyo:!0,duration:300,repeat:-1}))}selectedTileTweenDestroy(e){1==e&&this.firstSelectedTileTween?(this.firstSelectedTileTween.targets&&(this.firstSelectedTileTween.targets[0].angle=0),this.firstSelectedTileTween.destroy()):2==e&&this.secondSelectedTileTween&&(this.secondSelectedTileTween.targets&&(this.secondSelectedTileTween.targets[0].angle=0),this.secondSelectedTileTween.destroy())}resetTileTween(e,t){this.scene.add.tween({targets:e,y:h.tileHeight*t+h.tileHeight/2+h.alignY,ease:"bounce",duration:300,repeat:0,yoyo:!1})}fillTileTween(e,t){this.scene.add.tween({targets:e,y:h.tileHeight*t+h.tileHeight/2+h.alignY,duration:300,repeat:0,yoyo:!1,ease:"bounce",onComplete:()=>{var e;null===(e=this.gameScene)||void 0===e||e.checkMatches()}})}swapTileTween(e,t){this.scene.add.tween({targets:e,x:t.x,y:t.y,rotation:2*Math.PI,ease:"Quintic.easeInOut",duration:300,repeat:0,yoyo:!1}),this.scene.add.tween({targets:t,x:e.x,y:e.y,rotation:2*Math.PI,ease:"Quintic.easeInOut",duration:300,repeat:0,yoyo:!1,onComplete:()=>{var e;null===(e=this.gameScene)||void 0===e||e.checkMatches()}})}overlapTileTweenPlay(e,t,i){this.scene.add.tween({targets:e,x:t,y:i,duration:300,onComplete:()=>{for(const t of e)t.destroy()}})}playHintTween(e,t){var i;const s=e.x,h=e.y,l=t.x,r=t.y;null===(i=this.gameScene)||void 0===i||i.setIdle(!1),this.scene.add.tween({targets:e,x:l,y:r,duration:300,yoyo:!0,repeat:2,onComplete:()=>{var e;return null===(e=this.gameScene)||void 0===e?void 0:e.setIdle(!0)}}),this.scene.add.tween({targets:t,x:s,y:h,duration:300,yoyo:!0,repeat:2,onComplete:()=>{var e;return null===(e=this.gameScene)||void 0===e?void 0:e.setIdle(!0)}})}playLevelUpEffect(e){this.levelupPopup.resetPosition(),this.levelupPopup.setContent(e),this.scene.add.tween({targets:this.levelupPopup,duration:500,ease:"back",y:this.scene.sys.canvas.height/2}),this.scene.add.tween({targets:this.levelupPopup,delay:1500,alpha:0,duration:500,ease:"back",y:-200})}playBoardIdleEffect(){var e;null===(e=this.gameScene)||void 0===e||e.setIdle(!1);for(let e=0;e<h.gridHeight;e++)for(let t=0;t<h.gridWidth;t++)this.grids[e][t]&&this.scene.tweens.add({targets:this.grids[e][t],alpha:1,ease:"sine.inout",duration:400,delay:50*Math.abs(t+e),repeat:0,yoyo:!0,onComplete:()=>{var e;return null===(e=this.gameScene)||void 0===e?void 0:e.setIdle(!0)}})}}c.instance=null;class g extends Phaser.GameObjects.Container{constructor(e){super(e),this.align=10,this.maxScore=1e4,this.level=1,this.init()}init(){this.scene.add.container(0,0,this),this.setSize(this.scene.sys.canvas.width,144),this.add(this.scene.add.rectangle(0,0,this.width,this.height,255,1).setOrigin(0)),this.setPosition(0,0),this.progressbar=this.scene.add.rectangle(this.align,100,150,20,16777215).setOrigin(0).setDepth(1),this.progressbarFill=this.scene.add.rectangle(this.align,100,0,20,4315378).setOrigin(0).setDepth(1),this.scoreDisplay=this.scene.add.text(this.scene.sys.canvas.width/2,this.progressbar.y-20,"0",{fontSize:"48px",fontFamily:"Arial",color:"#ffffff"}).setOrigin(.5,0),this.progressbarEmitter=this.scene.add.particles(this.align,this.progressbarFill.y+this.progressbarFill.height/2,"flares",{frame:["white"],lifespan:250,speed:{min:60,max:80},scale:{start:.1,end:0},gravityY:0,blendMode:"ADD",emitting:!0,gravityX:-1e3}),this.levelDisplay=this.scene.add.text(10,100,"Level 1",{color:"#ffffff",fontSize:"16px",fontFamily:"Arial"}).setOrigin(0,1),this.add([this.progressbar,this.progressbarFill,this.levelDisplay])}updateProgreebar(e){this.scene.add.tween({targets:this.progressbarFill,duration:1e3,width:e/this.maxScore*150,repeat:0}),0==e&&(this.progressbarEmitter.gravityX=1e3),this.scene.add.tween({targets:this.progressbarEmitter,duration:1e3,x:e/this.maxScore*150+this.align,repeat:0,onComplete:()=>{this.progressbarEmitter.gravityX=-1e3}})}updateScore(e,t){this.scene.tweens.addCounter({from:e,to:t,duration:1e3,ease:"linear",onUpdate:e=>{this.scoreDisplay.setText(`${Math.round(e.getValue())}`)}}),this.scene.add.tween({targets:this.scoreDisplay,scale:1.2,yoyo:!0,duration:500})}levelUp(){this.level++,this.maxScore+=2e3,this.levelDisplay.setText(`Level ${this.level}`)}getMaxScore(){return this.maxScore}getLevel(){return this.level}}class p extends Phaser.Scene{constructor(){super({key:"GameScene"}),this.score=0,this.prevScore=0,p.instance=this,this.delta=h.delta}static getIntance(){return p.instance}init(){this.emitterManager=o.getInstance(this),this.progressUI=new g(this),this.tweenManager=c.getInstance(this),this.objectPool=r.getInstance(this),this.idle=!1,this.timeToplayIdleEffect=0,this.canMove=!0,this.findMove=!1,this.cameras.main.setBackgroundColor(7908062),this.tileGrid=[];for(let e=0;e<h.gridHeight;e++){this.tileGrid[e]=[];for(let t=0;t<h.gridWidth;t++){const i=this.addTile(t,e);this.tileGrid[e][t]=i}}this.debug(),this.restart(),this.input.on("gameobjectdown",this.tileDown,this),this.tweenManager.playLevelUpEffect(this.progressUI.getLevel()),this.idleTimeline=this.add.timeline({at:1e3,run:()=>{this.setIdle(!0)}}),this.matchesTimeLine=this.add.timeline([{at:500,run:()=>{this.resetTile(),this.fillTile(),this.tileUp()}}])}debug(){this.shuffleButton=this.add.text(this.sys.canvas.width-10,50,"Shuffle",{color:"#ffffff",fontSize:"32px",fontFamily:"Arial"}).setInteractive().setOrigin(1,0).setAlpha(.5).on("pointerdown",(()=>{this.idle&&this.restart()})),this.hintButton=this.add.text(this.sys.canvas.width-10,90,"Hint",{color:"#ffffff",fontSize:"32px",fontFamily:"Arial"}).setInteractive().setOrigin(1,0).setAlpha(.5).on("pointerdown",(()=>{this.idle&&this.hintMove()}))}shuffle(){if(this.tileGrid)for(let e=0;e<this.tileGrid.length;e++){const t=this.tileGrid[e];for(let i=t.length-1;i>0;i--){const s=Math.floor(Math.random()*(i+1));[t[i],t[s]]=[t[s],t[i]],this.emitterManager.setColorEmitter(s,e,t[s].getColor()),this.emitterManager.setColorEmitter(i,e,t[i].getColor())}}}restart(){this.tileGrid&&(this.setCanMove(!1),this.setIdle(!1),this.shuffle(),this.tweenManager.restartTweenPlay(this.tileGrid),this.tweenManager.selectedTileTweenDestroy(1),this.tweenManager.selectedTileTweenDestroy(2),this.firstSelectedTile=void 0,this.secondSelectedTile=void 0,this.findMove=!1)}addTile(e,t){return this.objectPool.addTile(e,t)}tileDown(e,t,i){if("Image"==(null==t?void 0:t.type)&&this.canMove)if(this.firstSelectedTile){if(this.firstSelectedTile==t||this.secondSelectedTile==t)return;if(this.secondSelectedTile=t,this.tweenManager.selectedTileTweenPlay(this.secondSelectedTile,2),this.secondSelectedTile){const e=Math.abs(this.firstSelectedTile.x-this.secondSelectedTile.x)/h.tileWidth,i=Math.abs(this.firstSelectedTile.y-this.secondSelectedTile.y)/h.tileHeight;1===e&&0===i||0===e&&1===i?(this.canMove=!1,this.swapTiles()):(this.tweenManager.selectedTileTweenDestroy(2),this.tweenManager.selectedTileTweenDestroy(1),this.firstSelectedTile=t,this.tweenManager.selectedTileTweenPlay(this.firstSelectedTile,1),this.secondSelectedTile=void 0)}}else this.firstSelectedTile=t,this.tweenManager.selectedTileTweenPlay(this.firstSelectedTile,1)}swapTiles(){if(this.tileGrid&&this.firstSelectedTile&&this.secondSelectedTile){const e={x:this.firstSelectedTile.x,y:this.firstSelectedTile.y},t={x:this.secondSelectedTile.x,y:this.secondSelectedTile.y};if(this.tileGrid){const i=Math.floor((e.x-h.tileWidth/2)/h.tileWidth),s=Math.floor((e.y-h.tileHeight/2-h.alignY)/h.tileHeight),l=Math.floor((t.x-h.tileWidth/2)/h.tileWidth),r=Math.floor((t.y-h.tileHeight/2-h.alignY)/h.tileHeight);this.tileGrid[s][i]=this.secondSelectedTile,this.tileGrid[r][l]=this.firstSelectedTile,this.emitterManager.setColorEmitter(i,s,this.secondSelectedTile.getColor()),this.emitterManager.setColorEmitter(l,r,this.firstSelectedTile.getColor())}if(this.tweenManager.swapTileTween(this.firstSelectedTile,this.secondSelectedTile),this.tileGrid){const i=Math.floor((e.x-h.tileWidth/2)/h.tileWidth),s=Math.floor((e.y-h.tileHeight/2-h.alignY)/h.tileHeight),l=Math.floor((t.x-h.tileWidth/2)/h.tileWidth),r=Math.floor((t.y-h.tileHeight/2-h.alignY)/h.tileHeight);this.firstSelectedTile=this.tileGrid[s][i],this.secondSelectedTile=this.tileGrid[r][l]}}}checkMatches(){var e,t;if(!this.tileGrid||this.score-this.prevScore>=this.progressUI.getMaxScore())return;if(this.setIdle(!1),this.idleTimeline.reset(),this.idleTimeline.play(),this.firstSelectedTile&&this.secondSelectedTile){if((null===(e=this.firstSelectedTile)||void 0===e?void 0:e.getOverlap())>=5){const e=this.getTilePos(this.tileGrid,this.firstSelectedTile);return this.remove5Matches(e.x,e.y,this.secondSelectedTile),void this.destroyCell(e.x,e.y)}if((null===(t=this.secondSelectedTile)||void 0===t?void 0:t.getOverlap())>=5){const e=this.getTilePos(this.tileGrid,this.secondSelectedTile);return this.remove5Matches(e.x,e.y,this.firstSelectedTile),void this.destroyCell(e.x,e.y)}}const i=this.getMatches(this.tileGrid);i.length>0?(this.removeTileGroup(i),this.matchesTimeLine.reset(),this.matchesTimeLine.play()):(this.swapTiles(),this.tileUp())}resetTile(){if(this.tileGrid)for(let e=this.tileGrid.length-1;e>0;e--)for(let t=this.tileGrid[e].length-1;t>=0;t--)if(void 0===this.tileGrid[e][t]){let i=e;for(;i-1>0&&void 0===this.tileGrid[i-1][t];)i--;const s=this.tileGrid[i-1][t];this.tileGrid[e][t]=s,this.emitterManager.setColorEmitter(t,e,null==s?void 0:s.getColor()),this.tileGrid[i-1][t]=void 0,this.tweenManager.resetTileTween(s,e)}}fillTile(){if(this.tileGrid)for(let e=0;e<this.tileGrid.length;e++)for(let t=0;t<this.tileGrid[e].length;t++){let i=0;for(;void 0===this.tileGrid[e][t];){const s=this.addTile(t,e);let l=e;for(;l+1<this.tileGrid.length&&void 0===this.tileGrid[l+1][t];)l+=1;0==e&&s.setY(-h.tileHeight*(i-.5)),this.tweenManager.fillTileTween(s,l),this.tileGrid[l][t]=s,this.emitterManager.setColorEmitter(t,l,null==s?void 0:s.getColor()),i++}}}tileUp(){this.tweenManager.selectedTileTweenDestroy(1),this.tweenManager.selectedTileTweenDestroy(2),this.firstSelectedTile=void 0,this.secondSelectedTile=void 0}removeTileGroup(e){if(!this.tileGrid)return;const t=this.score;e.sort(((e,t)=>t.length-e.length));for(let t=0;t<e.length;t++){const i=e[t].filter((e=>e.active));for(let e=0;e<i.length;e++){const t=i[e],s=this.getTilePos(this.tileGrid,t);-1!==s.x&&-1!==s.y&&(this.findMove=!1,i.length>=4&&(this.firstSelectedTile||this.secondSelectedTile)?(t==this.firstSelectedTile||t==this.secondSelectedTile?(t.setOverlap(i.length),this.tweenManager.overlapTileTweenPlay(i.filter((e=>e!=t)),t.x,t.y)):(this.tileGrid[s.y][s.x]=void 0,t.setActive(!1)),this.score+=100*i.length):i.length>=4?(0==e?(t.setOverlap(i.length),this.tweenManager.overlapTileTweenPlay(i.filter((e=>e!=t)),t.x,t.y)):(this.tileGrid[s.y][s.x]=void 0,t.setActive(!1)),this.score+=100*i.length):(4==t.getOverlap()&&(this.remove4Matches(s.x,s.y),this.cameras.main.shake(500,.02)),t.isDestroyed()||(this.destroyCell(s.x,s.y),this.score+=100)))}}this.progressUI.updateProgreebar(this.score-this.prevScore),this.progressUI.updateScore(t,this.score)}getTilePos(e,t){const i={x:-1,y:-1};for(let s=0;s<e.length;s++)for(let h=0;h<e[s].length;h++)if(t===e[s][h]){i.x=h,i.y=s;break}return i}getMatches(e){const t=[];let i=[];for(let s=0;s<e.length;s++){const h=e[s];i=[];for(let l=0;l<h.length;l++)l<h.length-2&&e[s][l]&&e[s][l+1]&&e[s][l+2]&&e[s][l].texture.key===e[s][l+1].texture.key&&e[s][l+1].texture.key===e[s][l+2].texture.key&&(i.length>0&&-1==i.indexOf(e[s][l])&&(t.push(i),i=[]),-1==i.indexOf(e[s][l])&&i.push(e[s][l]),-1==i.indexOf(e[s][l+1])&&i.push(e[s][l+1]),-1==i.indexOf(e[s][l+2])&&i.push(e[s][l+2]));i.length>0&&t.push(i)}for(let s=0;s<e.length;s++){const h=e[s];i=[];for(let l=0;l<h.length;l++)l<h.length-2&&e[l][s]&&e[l+1][s]&&e[l+2][s]&&e[l][s].texture.key===e[l+1][s].texture.key&&e[l+1][s].texture.key===e[l+2][s].texture.key&&(i.length>0&&-1==i.indexOf(e[l][s])&&(t.push(i),i=[]),-1==i.indexOf(e[l][s])&&i.push(e[l][s]),-1==i.indexOf(e[l+1][s])&&i.push(e[l+1][s]),-1==i.indexOf(e[l+2][s])&&i.push(e[l+2][s]));i.length>0&&t.push(i)}return t}hintMove(){if(this.findMove=!1,!this.tileGrid||this.findMove)return;const e=Phaser.Math.Between(1,h.gridHeight-1);for(let t=e;t>=0&&!this.findMove;t--)for(let e=0;e<this.tileGrid[t].length&&!this.findMove;e++)!this.findMove&&t<this.tileGrid.length-1&&(this.swapTileVertical(t,t+1,e),this.getMatches(this.tileGrid).length&&(this.findMove=!0),this.swapTileVertical(t,t+1,e),this.findMove&&(console.log(`(x: ${e},y: ${t}), 1`),this.tweenManager.playHintTween(this.tileGrid[t][e],this.tileGrid[t+1][e]))),!this.findMove&&e<this.tileGrid[0].length-1&&(this.swapTileHorizontal(e,e+1,t),this.getMatches(this.tileGrid).length&&(this.findMove=!0),this.swapTileHorizontal(e,e+1,t),this.findMove&&(console.log(`(x: ${e},y: ${t}), 2`),this.tweenManager.playHintTween(this.tileGrid[t][e],this.tileGrid[t][e+1])));if(!this.findMove){for(let t=e+1;t<this.tileGrid.length&&!this.findMove;t++)for(let e=0;e<this.tileGrid[t].length&&!this.findMove;e++)!this.findMove&&t<this.tileGrid.length-1&&(this.swapTileVertical(t,t+1,e),this.getMatches(this.tileGrid).length&&(this.findMove=!0),this.swapTileVertical(t,t+1,e),this.findMove&&(console.log(`(x: ${e},y: ${t}), 1`),this.tweenManager.playHintTween(this.tileGrid[t][e],this.tileGrid[t+1][e]))),!this.findMove&&e<this.tileGrid[0].length-1&&(this.swapTileHorizontal(e,e+1,t),this.getMatches(this.tileGrid).length&&(this.findMove=!0),this.swapTileHorizontal(e,e+1,t),this.findMove&&(console.log(`(x: ${e},y: ${t}), 2`),this.tweenManager.playHintTween(this.tileGrid[t][e],this.tileGrid[t][e+1])));this.findMove||console.log("No move")}}swapTileVertical(e,t,i){if(!this.tileGrid)return;const s=this.tileGrid[e][i];this.tileGrid[e][i]=this.tileGrid[t][i],this.tileGrid[t][i]=s}swapTileHorizontal(e,t,i){if(!this.tileGrid)return;const s=this.tileGrid[i][e];this.tileGrid[i][e]=this.tileGrid[i][t],this.tileGrid[i][t]=s}update(e,t){this.delta=t,this.idle?(this.timeToplayIdleEffect++,this.score-this.prevScore>=this.progressUI.getMaxScore()&&(this.restart(),this.progressUI.updateProgreebar(0),this.progressUI.levelUp(),this.tweenManager.playLevelUpEffect(this.progressUI.getLevel()),this.emitterManager.playConfettiEffect(),this.prevScore=this.score),this.timeToplayIdleEffect>=1e3&&(this.timeToplayIdleEffect=0,this.tweenManager.playBoardIdleEffect()),this.hintButton.setAlpha(1),this.shuffleButton.setAlpha(1),this.canMove=!0):(this.timeToplayIdleEffect=0,this.hintButton.setAlpha(.5),this.shuffleButton.setAlpha(.5),this.canMove=!1)}setCanMove(e){this.canMove=e}setIdle(e){this.idle=e}removeAllInRow(e){if(this.tileGrid)for(let t=0;t<this.tileGrid[e].length;t++)this.tileGrid[e][t]&&(this.destroyCell(t,e),this.score+=100)}removeAllInColumn(e){if(this.tileGrid)for(let t=0;t<this.tileGrid.length;t++)this.tileGrid[t][e]&&(this.destroyCell(e,t),this.score+=100)}remove4Matches(e,t){if(!this.tileGrid)return;const i=[];e>0&&this.tileGrid[t][e-1]&&(this.tileGrid[t][e-1].getOverlap()>=5?(this.removeAllInColumn(e-1),this.removeAllInRow(t)):this.tileGrid[t][e-1]&&4==this.tileGrid[t][e-1].getOverlap()?(i.push({x:e-1,y:t}),this.destroyCell(e-1,t),this.score+=100):(this.destroyCell(e-1,t),this.score+=100)),e<h.gridWidth-1&&this.tileGrid[t][e+1]&&(this.tileGrid[t][e+1].getOverlap()>=5?(this.removeAllInColumn(e+1),this.removeAllInRow(t)):this.tileGrid[t][e+1]&&4==this.tileGrid[t][e+1].getOverlap()?(i.push({x:e+1,y:t}),this.destroyCell(e+1,t),this.score+=100):(this.destroyCell(e+1,t),this.score+=100)),t>0&&this.tileGrid[t-1][e]&&(this.tileGrid[t-1][e].getOverlap()>=5?(this.removeAllInColumn(e),this.removeAllInRow(t-1)):this.tileGrid[t-1][e]&&4==this.tileGrid[t-1][e].getOverlap()?(i.push({x:e,y:t-1}),this.destroyCell(e,t-1),this.score+=100):(this.destroyCell(e,t-1),this.score+=100)),t<h.gridHeight-1&&this.tileGrid[t+1][e]&&(this.tileGrid[t+1][e].getOverlap()>=5?(this.removeAllInColumn(e),this.removeAllInRow(t+1)):this.tileGrid[t+1][e]&&4==this.tileGrid[t+1][e].getOverlap()?(i.push({x:e,y:t+1}),this.destroyCell(e,t+1),this.score+=100):(this.destroyCell(e,t+1),this.score+=100));for(const e of i)this.remove4Matches(e.x,e.y)}remove5Matches(e,t,i){if(!this.tileGrid)return;const s=this.score;for(let e=0;e<this.tileGrid.length;e++)for(let t=0;t<this.tileGrid[e].length;t++)this.tileGrid[e][t]&&this.tileGrid[e][t].texture.key==i.texture.key&&(this.destroyCell(t,e),this.score+=100);this.progressUI.updateProgreebar(this.score-this.prevScore),this.progressUI.updateScore(s,this.score),this.matchesTimeLine.reset(),this.matchesTimeLine.play(),this.cameras.main.shake(500,.03)}destroyCell(e,t){if(!this.tileGrid||!this.tileGrid[t][e])return;const i=this.tileGrid[t][e];this.emitterManager.explodeBoardEmitter(e,t),this.tileGrid[t][e]=void 0,i.setDepth(3),i.setActive(!1),i.getOverlap()>=5?i.destroy():this.add.tween({targets:i,scale:.2,x:100,y:100,duration:300,onComplete:()=>{i.destroy()}})}}p.instance=null;const f={title:"Candy crush",url:"https://github.com/digitsensitive/phaser3-typescript",version:"2.0",width:520,height:720,type:Phaser.AUTO,parent:"game",scene:[s,p],physics:{default:"arcade",arcade:{gravity:{y:400},debug:!1}},render:{pixelArt:!1,antialias:!0}};class y extends Phaser.Game{constructor(e){super(e)}}window.addEventListener("load",(()=>{new y(f)}))}},i={};function s(e){var h=i[e];if(void 0!==h)return h.exports;var l=i[e]={exports:{}};return t[e].call(l.exports,l,l.exports,s),l.exports}s.m=t,e=[],s.O=(t,i,h,l)=>{if(!i){var r=1/0;for(d=0;d<e.length;d++){for(var[i,h,l]=e[d],a=!0,n=0;n<i.length;n++)(!1&l||r>=l)&&Object.keys(s.O).every((e=>s.O[e](i[n])))?i.splice(n--,1):(a=!1,l<r&&(r=l));if(a){e.splice(d--,1);var o=h();void 0!==o&&(t=o)}}return t}l=l||0;for(var d=e.length;d>0&&e[d-1][2]>l;d--)e[d]=e[d-1];e[d]=[i,h,l]},s.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),(()=>{var e={179:0};s.O.j=t=>0===e[t];var t=(t,i)=>{var h,l,[r,a,n]=i,o=0;if(r.some((t=>0!==e[t]))){for(h in a)s.o(a,h)&&(s.m[h]=a[h]);if(n)var d=n(s)}for(t&&t(i);o<r.length;o++)l=r[o],s.o(e,l)&&e[l]&&e[l][0](),e[l]=0;return s.O(d)},i=self.webpackChunktype_project_template=self.webpackChunktype_project_template||[];i.forEach(t.bind(null,0)),i.push=t.bind(null,i.push.bind(i))})();var h=s.O(void 0,[216],(()=>s(5)));h=s.O(h)})();